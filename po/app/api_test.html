<!DOCTYPE HTML>  
<html>  
<head>  
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  
    <script src="../js/jquery.js"></script>  
    <script src="js/sha/sha1.js"></script>
    <script src="js/sha/enc-base64-min.js"></script>
    <script type="text/javascript">  
    $(function(){  
    	$.extend({
    		  getUrlVars: function(){
    		    var vars = [], hash;
    		    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    		    for(var i = 0; i < hashes.length; i++)
    		    {
    		      hash = hashes[i].split('=');
    		      vars.push(hash[0]);
    		      vars[hash[0]] = hash[1];
    		    }
    		    return vars;
    		  },
    		  getUrlVar: function(name){
    		    return $.getUrlVars()[name];
    		  }
    		});
    	
    	// Getting URL var by its nam
    	api_type = $.getUrlVar('api_type');

      if(!api_type) return false;
    	//api 網址
        var base_url = "https://apserver.mitake.com.tw/apiv1/";
        //var base_url = "http://10.1.17.116:8090/apiv1/";
        
        var ui,at,gi,gn,gd,ga,gm,device_token,zoom_out_cnt,zoom_in_cnt,group_list;
        
        //ajax用
        var myRand = Math.floor((Math.random()*1000)+1);
     
        var id = "+886980922917";
        //登入認證
        var api_name = "login";

        var headers = {
            li:"zh_TW"
        };
        var body = {
            id: id,
            tp:"0",
            pw:toSha1Encode("111111")
        };
        var method = "post";
        var result = ajaxDo(api_name,headers,method,true,body);
        result.complete(function(data){
        	ui = $.parseJSON(data.responseText).ui;
            at = $.parseJSON(data.responseText).at;

            switch(api_type){ // groups/{gi}/invitations
                case "permission":
                    var api_name = "groups/5db48ed8-4f8c-4c68-b147-21f4d0a48e7b/permissions";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var body = {
                            ti: "fd97294e-eee3-4e64-bdf5-10e853de4373",
                            tu:{
                              gul: [
                                
                              ]  
                            }
                        }

                    var method = "post";
                    var result = ajaxDo(api_name,headers,method,false,body);
                    break;
                case "getS3url":
                    var api_name = "groups/5db48ed8-4f8c-4c68-b147-21f4d0a48e7b/files/";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var body = {
                          fn: "test",
                          tp: 1,
                          ti: "fd97294e-eee3-4e64-bdf5-10e853de4373",
                          pi: 0
                        }

                    var method = "post";

                    var result = ajaxDo(api_name,headers,method,false,body);
                    break;
                case "invite":
                    var api_name = "groups/d75bb5ec-7b1f-4dd1-9e60-e3f41e146c5c/invitations";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var method = "post";

                    var body = {
                          "ul":
                            [
                              {
                                "cc": "+886",
                                "pn": "980922917",
                                "em": body.ul.em,
                                "nk": body.ul.nk
                              }
                            ]
                        }
                                     
                    var result = ajaxDo(api_name,headers,method,true,body);
                  break;
                case "upload_commit":
                    var api_name = "groups/1a9bca59-766d-402d-b5ea-9ad973e10d45/files/bd157262-4fba-46e8-8bff-3c293054e802/commit";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var method = "put";

                    var body = {
                      "ti": "380b2466-6492-465b-ae3e-a498d22eb0c4",
                      "pi": 0,
                      "tp": 1,
                      "mt": "image/gif",
                      "si": 1954684
                    }
                    var result = ajaxDo(api_name,headers,method,true,body);
                  break;
                case "pic":///groups/{gi}/files/{fi}{?pi}
                    var api_name = "groups/f8ea78e9-8f33-45ce-a94c-029a47464688/files/4c8b7326-a369-4a87-a3ab-adc554348d42?pi=0";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var method = "get";

                    var result = ajaxDo(api_name,headers,method,true);
                  break;
                case "compose_vote":
                    var api_name = "groups/b1c77966-6037-4244-82fc-a37d4d0504a8/timelines/177bb2ec-0f7d-4dba-8d2d-6af8c8b225d7/events";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var method = "post";

                    var body = {
                          "meta":
                          {
                            //"lv": 0(使用者)、1(團體)、2(團體使用者)、3(群組),
                            //"tp": [0](0=樓主,1=回覆訊息)、[1](0=訊息,1=公告,2=通報專區,3=任務-工作,4=任務-投票,5=任務-定點回報,6=行事曆)
                            "lv":"1",
                            "tp":"04"
                          },
                          "ml":[
                            {
                              "li": [
                                {
                                  "k": 0,
                                  "t": "照片裡的人，誰最上相",
                                  "v": 1,
                                  "i": [
                                    {
                                      "k": 0,
                                      "o": "楊Google "
                                    },
                                    {
                                      "k": 1,
                                      "o": "楊股溝"
                                    },
                                    {
                                      "k": 2,
                                      "o": "股溝楊"
                                    }
                                  ]
                                }
                              ],
                              "b": 1401282581000,
                              "e": 1401368981000,
                              "tp": 14
                            } 
                          ]
                        }
                                     
                    var result = ajaxDo(api_name,headers,method,true,body);
                     
                    break;
                case "timeline_post"://0efa069a-b882-4ea6-a78e-c36966ee4aa1
                    var api_name = "groups/0efa069a-b882-4ea6-a78e-c36966ee4aa1/timelines/14876c4b-508c-4bb4-9e23-ff292a01acbc/events?ep=Event-999";

                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                                 };
                    var method = "post";

                    var body = {
                          "meta":
                          {
                            //"lv": 0(使用者)、1(團體)、2(團體使用者)、3(群組),
                            //"tp": [0](0=樓主,1=回覆訊息)、[1](0=訊息,1=公告,2=通報專區,3=任務-工作,4=任務-投票,5=任務-定點回報,6=行事曆)
                            "lv":"1",
                            "tp":"13",
                            "fin":false
                          },
                          "ml":
                          [
                            {
                              "tp": 13,
                              "k": 1,
                              "a": true
                            }
                          ]
                        }
                                     
                    var result = ajaxDo(api_name,headers,method,true,body);
                     
                    break;
                case "timeline_status_update":
                    var api_name = "groups/62cd6a3a-77b9-4f84-8f2d-854020665134/timelines/92a940f7-02bd-4413-88fc-57c4f7836ee4/events/Event-115.Event-116";

                    // etp: 0(讀取),1(按讚),2(按X),3(按訂閱),4(按置頂),6(是否有行事曆)
                    // est: 0(取消),1(執行)
                    var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW",
                             "etp":0,
                             "est":1
                                 };
                     var method = "put";
                                     
                    var result = ajaxDo(api_name,headers,method,true);
                     
                    break;
                case "timeline_participants"://這則單一事件的各種回復狀態 Type(0=讀取,1=按讚,2=按X,3=按訂閱,4=按置頂,7=按任務)
                	 var api_name = "groups/3564cbb8-81a3-47a3-b0f3-89822762029f/timelines/0efb2a90-fb99-4ce8-b80e-646bba745ea6/events/Event-148.Event-165/participants?tp=1";
                	 var headers = {
                             "ui":ui,
                             "at":at, 
                             "li":"zh_TW"
                                 };
                     var method = "get";
                                     
                     //{"tp":0,"rsp_code":999,"rsp_msg":"無群組權限"} 
                     
                    var result = ajaxDo(api_name,headers,method,true);
                     
                	break;
                case "timeline_status"://理解是 自己對於這則timeline event 的各種狀態 is read is like is reply etc...
                    var api_name = "groups/62cd6a3a-77b9-4f84-8f2d-854020665134/timelines/92a940f7-02bd-4413-88fc-57c4f7836ee4/events_status?ep=Event-116";
                    console.log(api_name);
                    var headers = {
                            "ui":ui,
                            "at":at, 
                            "li":"zh_TW"
                                };
                    var method = "get";
                    
                    
                    var result = ajaxDo(api_name,headers,method,true);
                    
                   break;
                case "timeline_list"://動態消息
                    var api_name = "groups/3564cbb8-81a3-47a3-b0f3-89822762029f/timelines/0efb2a90-fb99-4ce8-b80e-646bba745ea6/events";
                    var headers = {
                            "ui":ui,
                            "at":at, 
                            "li":"zh_TW"
                                };
                    var method = "get";
                    
                    
                    var result = ajaxDo(api_name,headers,method,true);
                    
                   break;
                case "timeline_one"://單一動態消息
                    //var api_name = "groups/e2b777c8-68a7-468e-b9e4-b2434ccb86fb/timelines/3f191b19-d532-43b7-a696-ddd40e020670/events/Event-148";
                    var api_name = "groups/3564cbb8-81a3-47a3-b0f3-89822762029f/timelines/0efb2a90-fb99-4ce8-b80e-646bba745ea6/events/Event-369";
                    var headers = {
                            "ui":ui,
                            "at":at, 
                            "li":"zh_TW"
                                };
                    var method = "get";
                    
                    
                    var result = ajaxDo(api_name,headers,method,true);
                    
                    
                   break;
                   
                case "groups"://所有團體
                    var api_name = "groups";
                    var headers = {
                        "ui":ui,
                        "at":at,
                        "li":"zh_TW",
                    };
                    var method = "get";
                    var result = ajaxDo(api_name,headers,method,true);
                    	//tl 有3個 行事曆 tp=1 ; 動態 2 ; 聊天室 3 
                    	//"{"gl":[{"gi":"83c7be55-5b09-459f-aea6-b345b49b6cab","gn":"三豬雲","ga":"","ad":2,"cnt":11,"tl":[{"ti":"12a6807c-acee-4b1e-8da0-0f84bcb573ac","tp":3},{"ti":"92c954b5-e343-44d5-bf95-70a6ef53ef4e","tp":1},{"ti":"e874c0da-845c-4635-970f-ed4764047960","tp":2}],"me":"85820d46-18a2-4bed-9641-513f74a5e875"}],"rsp_code":0,"rsp_msg":"取得完成"}"
                    
                    	break;
                    
                case "group/user"://單一團體
                	var api_name = "groups/0efa069a-b882-4ea6-a78e-c36966ee4aa1/users";
                    var headers = {
                        "ui":ui,
                        "at":at,
                        "li":"zh_TW",
                    };
                    var method = "get";
                    var result = ajaxDo(api_name,headers,method,true);
                    break;
                case "group/create"://建團    
                    var api_name = "groups";
                    var headers = {
                        "ui":ui,
                        "at":at,
                        "li":"zh_TW",
                    };
                    var body = {
                   		"gn":"brian test",
                        "gd":"哈囉"
                    }
                    

                    var method = "post";

                    console.log(api_name);
                    console.log(headers);
                    console.log(method);
                    console.log(body);
                    var result = ajaxDo(api_name,headers,method,true,body);
                    break;
            }
            
            
            result.complete(function(data){
                //console.log($.parseJSON(data.responseText));
                var t =$.parseJSON(data.responseText);
                console.log(t.rsp_code);
                console.log(JSON.stringify(t,null,2));
                
                $("textarea").html(JSON.stringify(t,null,2));
                
            });
            
            return false;
            
        });
  
        
//ajax

        //ajax
        function ajaxDo(api_name,headers,method,load_show_chk,body){
            //設定是否顯示 loading 圖示
            load_show = load_show_chk;

            //console.log(api_url);
            var api_url = base_url + api_name;
            var myRand = Math.floor((Math.random()*1000)+1);

            if(body){
                body = JSON.stringify(body);
            }

            var result = $.ajax ({
                url: api_url,
                type: method,
                headers:headers,
                data:body
            });

            return result;
        }
     function ajaxDos(api_name,headers,method,async,body){
         //console.log(api_url);
         var api_url = base_url + api_name;
         
         if(async){
             var result = $.ajax ({
                 url: api_url,
                 type: method,
                 headers:headers,
                 data:body
             });/* ajax結束 */
         }else{
             var result = $.ajax ({
                 url: api_url,
                 type: method,
                 headers:headers,
                 async:false,
             });/* ajax結束 */
         }
         
         return result;
     } 
     
     //sha1 and base64 encode
     function toSha1Encode(string){
         var hash = CryptoJS.SHA1(string);
         var toBase64 = hash.toString(CryptoJS.enc.Base64);
         return toBase64;
     }
 });  
   </script>   
</head>  
<body>  
   <textarea style="font-size:15px;width:80%;height:1000px"></textarea>
</body>  
</html>  