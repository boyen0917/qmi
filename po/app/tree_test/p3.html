<!DOCTYPE html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <meta charset=utf-8 />
 
        <script>
            $(function() {
            	group_str_arr = [];
            		relation_arr = [];

                    	group_str_arr.push("金融服務事業群/金融研發一部");
                    	group_str_arr.push("管理部");
                    	group_str_arr.push("APP應用事業群/APP專案部/aaaaa");
                    	group_str_arr.push("APP應用事業群/APP業務部/bbbbb");

                    	max_group_cnt = 3;
                    	
                    	var hierachy_arr = {"name": "root","children": [{"name": "三竹資訊","children": []}]};
                        
                    	//製作各節點關聯
                    	/* $.each(group_str_arr,function(i,val){
                            base_arr = val.split("/");
                            $.each(base_arr,function(i,val){
                                result_val = val;
                                chk = 0;
                                $.each(relation_arr,function(i,val){
                                    if(val[0] == result_val){
                                        chk = 1;
                                        return false;
                                    }
                                });
                                
                                if(chk == 0){
                                    result_child_arr = [];
                                    if(i == 0){
                                        result_child_arr[1] = "三竹資訊";
                                    }else{
                                        result_child_arr[1] = base_arr[i-1];
                                    }
                                    result_child_arr[0] = val;
                                    relation_arr.push(result_child_arr);
                                }
                            });
                        }); */
                       
                    	
                    	
                    	relation_arr = [
                                        ["金融研發一部","金融服務事業群"],
                    	                ["APP業務部","APP應用事業群"],
                    	                ["ddddd","APP業務部"],
                    	                ["金融服務事業群","三竹資訊"],
                    	                ["APP應用事業群","三竹資訊"]
                    	               ];
                    	
                        $.each(relation_arr,function(i,val){
                            dup_chk=0;
                            doEach(hierachy_arr.children,val);
                            
                        });

                        hierachy_arr = hierachy_arr.children[0];
                        
                        console.log(JSON.stringify(hierachy_arr));
                        return false;
                        
                        function doEach(arr,target_arr){
                        	
                            if(!target_arr){
                            	console.log(1);
                                return false;
                            }
                            
                            $.each(arr,function(i,val){
                            	
                                if(val.name == target_arr[1]){
                                	
                                	//排除重複
                                	if(val.children){
                                		$.each(val.children,function(i,val){
                                			if(val.name == target_arr[0]){
                                				dup_chk = 1;
                                			}
                                        });
                                	}
                                	
                                	if(dup_chk != 0){
                                		   return false;	
                                	}
                                	
                                    if(!val.children){
                                        val.children = [];
                                    }
                                    val.children.push({"name":target_arr[0]+""});
                                    return false;
                                }
                                if(val.children){
                                    doEach(val.children,target_arr);   
                                }
                            });
                        }
                        
            });
    
        </script>
 
    </head>
    <body>
 
    </body>
</html>