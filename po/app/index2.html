<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Project O</title>
        <link rel="stylesheet" href="../css/jquery.mobile-1.3.2.min.css" />
        <link rel="stylesheet" href="css/main.css" />
        <script src="../js/jquery.js"></script>
        <script src="../js/jquery.mobile-1.3.2.min.js"></script>
        <script src="js/sha/sha1.js"></script>
        <script src="js/sha/enc-base64-min.js"></script>
    </head>
    <body>
<!---------------------------------- page-group-main ------------------------------------>
        <div data-role="page" id="page-group-main">
            <div data-role="panel" id="side-menu" data-display="push">
                <div class="sm-user-area">
                   <div class="sm-user-area-l"></div>
                   <div class="sm-user-area-r"></div>
                </div>
                <div data-sm-act="feed" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_feed.png"/></div>
                   <div class="sm-small-area-r">動態消息</div>
                   <div class="sm-count">315</div>
                </div>
                <div data-sm-act="contact" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_contact.png"/></div>
                   <div class="sm-small-area-r">聯絡人</div>
                   <div class="sm-count"></div>
                </div>
                <div data-sm-act="chat" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_chat.png"/></div>
                   <div class="sm-small-area-r">聊天</div>
                   <div class="sm-count"></div>
                </div>
                <div data-sm-act="calendar" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_calendar.png"/></div>
                   <div class="sm-small-area-r">行事曆</div>
                   <div class="sm-count"></div>
                </div>
                <div class="sm-hr">團體</div>
                <div class="sm-group-list-area">
                  
                </div>
                <div class="sm-group-list-area-add">
                    
                </div>
                <div class="sm-group-switch"><div class="sm-switch-ui-adj"></div><img src="images/side_menu/sidemenu_slidedown_icon_click.png"/></div>
                <div class="sm-group-cj">
                    <div class="hg-create sm-group-cj-btn">新增團體</div>
                    <div class="hg-invited sm-group-cj-btn" >團體邀請</div>
                </div>
                <div class="sm-hr">系統</div>
                <div data-sm-act="help" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_help.png"/></div>
                   <div class="sm-small-area-r">幫助</div>
                </div>
                <div data-sm-act="news" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_news.png"/></div>
                   <div class="sm-small-area-r">最新消息</div>
                </div>
                <div data-sm-act="setting" class="sm-small-area">
                   <div class="sm-small-area-l"><img src="images/side_menu/sidemenu_icon_setting.png"/></div>
                   <div class="sm-small-area-r">系統設定</div>
                </div>
            </div>
            <div data-theme="c" data-role="header" data-position="fixed" data-tap-toggle="false">
                <div class="side-menu-btn"></div>
                <img class="side-menu-btn" src="images/side_menu_btn.png"/>
                <h3>成員</h3>
            </div>
            <div data-role="content">
                <div class="gm-subpage-main">
                
                </div>
        </div><!-- /page-group-main -->


<!---------------------------------- 全域 ------------------------------------>        
        <div class="popup">
          <div class="popup-frame">
          <div class="popup-text"></div>
          <a href="#" class="popup-close" data-role="button" data-inline="true">確定</a>
          </div>
          <div class="popup-screen"></div>
        </div>

        <div class="ui-loader ui-corner-all ui-body-a ui-loader-default"><span class="ui-icon ui-icon-loading"></span><h1>loading</h1></div>
        
        <div id="page-back-chk"></div>
        <div id="page-back-chk-pre"></div>
        
        <script type="text/javascript">
            $(function(){
            	//api 網址
                var base_url = "https://apserver.mitake.com.tw/apiv1/";
                //var base_url = "http://10.1.17.116:8090/apiv1/";
                //ajax用
                var myRand = Math.floor((Math.random()*1000)+1);
                
                //全域
                var ui,at,gi,gn,gd,ga,gm,device_token;
                
                //計算螢幕長寬以維持比例
                var proportion = 1.7;
                $(".main").css("width",$(window).width());
                $(".main").css("height",$(window).width()*proportion);
                $(".main-contact-l").css("height",$(window).height()-186);
                $(window).resize(function(){ 
                    $(".main").css("width",$(window).width());
                    $(".main").css("height",$(window).width()*proportion);
                    $(".main-contact-l").css("height",$(window).height()-186);
                });
                
            	//----------------------------------- 左側選單 ---------------------------------------------
                $(".side-menu-btn").click(function(){
                    $( "#side-menu" ).panel( "open");
                });
                
                //用戶區
                //detect page changing
                $("#side-menu").on("panelbeforeopen",function(){
                        //取得個人圖像
                        $(".sm-user-area-l").html("<img class=\"sm-user-pic\" src=\"images/user_pic.png\"/>");
                        //計數
                        $("div[data-sm-act=feed] .sm-count").show();
                        $(".sm-group-area .sm-count").show();
                        
                });

                //開關團體列表
                $(".sm-group-switch").click(function(){
                    $(".sm-switch-ui-adj").removeClass("sm-switch-ui-adj-show");
                    $(".sm-group-list-area-add").slideToggle(
                        function(){
                            if($(".sm-group-list-area-add").is(":visible")){
                                $(".sm-group-switch").find("img").attr("src","images/side_menu/sidemenu_slidedown_icon_none.png");
                            }else{
                                $(".sm-group-switch").find("img").attr("src","images/side_menu/sidemenu_slidedown_icon_click.png"); 
                            }
                        }
                    );
                });
                
                //按鈕效果
                $(document).on("mousedown",".sm-small-area,.sm-group-area,.sm-group-cj-btn",function(){
                    var icon_default = "images/side_menu/sidemenu_icon_";
                    var target = $(this);
                    
                    //開關按鈕ui變化
                    if($(".sm-group-list-area-add").is(":visible") ){
                        if(target.data("switch-chk") == "check2"){
                            $(".sm-switch-ui-adj").addClass("sm-switch-ui-adj-show");
                        }
                    }else{
                        if(target.data("switch-chk") == "check"){
                            $(".sm-switch-ui-adj").addClass("sm-switch-ui-adj-show");
                        }
                    }
                    
                    target.addClass("sm-click-bg");
                    target.find(".sm-small-area-l img").attr("src",icon_default + target.data("sm-act") + "_click.png");
                    switch (target.data("sm-act")) {
                        case "feed":
                        	$(".gm-subpage-main").load("gm_subpage_timeline.html");
                        	$(".gm-subpage-main").trigger("click");
                          break;
                        case "contact": 
                        	$(".gm-subpage-main").load("gm_subpage_main.html");
                        	$(".gm-subpage-main").trigger("click");
                          break;
                        case "chat":
                          break;
                        case "calendar":
                          break;
                        case "help":
                          break;
                        case "news":
                          break;
                        case "setting":
                          break;
                    }
                });
                //按鈕效果
                $(document).on("mouseup",".sm-small-area,.sm-group-area,.sm-group-cj-btn",function(){
                    var icon_default = "images/side_menu/sidemenu_icon_";
                    var target = $(this);
                    setTimeout(function(){
                        //開關按鈕ui變化
                        if($(".sm-group-list-area-add").is(":visible") ){
                            if(target.data("switch-chk") == "check2"){
                                $(".sm-switch-ui-adj").removeClass("sm-switch-ui-adj-show");
                            }
                        }else{
                            if(target.data("switch-chk") == "check"){
                                $(".sm-switch-ui-adj").removeClass("sm-switch-ui-adj-show");
                            }
                        }
                        target.removeClass("sm-click-bg");
                        target.find(".sm-small-area-l img").attr("src",icon_default + target.data("sm-act") + ".png");
                        },500);
                });
//----------------------------------- 聯絡人 ---------------------------------------------  
                $(".gm-subpage-main").load("gm_subpage_main.html");


                //功能選單
                $(".main-more-btn").click(function(){
                    var target = $(".main-footer-add");
                    if(target.css("bottom") == "125px"){
                        $(".main-footer-add").animate({bottom:"194px"},function(){
                            $(".main-footer").css("z-index","0");
                        }); 
                    }else if($(".main-footer").css("z-index") == "0"){
                        $(".main-footer").css("z-index","100");
                        $(".main-footer-add").animate({bottom:"125px"});
                    }
                });
                
                //功能選單 按鈕效果
                $(".main-footer-item").click(function(){
                    var main_act = $(this).data("main-act");
                    var img_url = "images/contact/toolbar_icon_";
                    $(".main-footer-item").each(function(i,val){
                        $(this).children().attr("src",img_url + $(this).data("main-act") + ".png");
                        $(this).find("div").removeClass("color-white");
                    });
                    $(this).children().attr("src",img_url + $(this).data("main-act") + "_active.png");
                    $(this).find("div").addClass("color-white");

                    switch (main_act) {
                        case "chat":
                            $.mobile.changePage("#page-chatroom");
                          break;
                    }
                });
                
                //團體群組 按鈕效果
                $(".main-contact-l-row").click(function(){
                    var ori_target = $(this);
                    var img_url = "images/contact/contact_sidemenu_";
                    //將聯絡人群組全部換成關閉狀態
                    $(".main-contact-l-row").css("background","url(" + img_url + "rowbg.png)");
                    $(".main-contact-l-row img").attr("src",img_url + "icon_arrow.png");
                    $(".main-contact-l-row").removeClass("color-white");
                    
                    //目標群組換成按下效果
                    ori_target.css("background","url(" + img_url + "rowbg_unfold.png)");
                    ori_target.addClass("color-white");
                    
                    //關閉所有子群組使用動畫效果
                    $(".main-contact-l-row-subarea").each(function(i,val){
                        //不是現在按下的子群組同時高度不為零 表示除了現在按下的以外 全部用動畫效果來關閉
                        if(!$(this).is(ori_target.next()) && $(this).css("height") != "0px"){
                            $(this).animate({height:"0px"},function(){
                                $(this).hide(); 
                            });
                        }
                    });
                    
                    //判斷開啓子群組
                    if(ori_target.data("main-sub-chk")){
                        //動畫呈現部門子群組
                        var subarea = ori_target.next();
                        subarea.show();
                        var subrow = subarea.find(".main-contact-l-subarea-row");
                        if(subarea.css("height") == "0px"){
                            subarea.animate({height:subrow.length*43}); 
                        }else{
                            subarea.animate({height:"0px"},function(){
                                ori_target.children().attr("src",img_url + "icon_arrow_white.png");
                                subarea.hide(); 
                            });
                        }
                        ori_target.children().attr("src",img_url + "icon_arrow_white_below.png");
                    }else{
                        ori_target.children().attr("src",img_url + "icon_arrow_white.png"); 
                        $(".main-contact-l-subarea-row").height("opx");
                    }
                });
            });
        </script>
    </body>
</html>