<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style type="text/css">
  
    .node {
    cursor: pointer;
  }

  .overlay{
      background-color:#EEE;
  }
   
  .node circle {
    fill: #fff;
    stroke: steelblue;
    stroke-width: 1.5px;
  }
   
  .node text {
    font-size:10px; 
    font-family:sans-serif;
  }
   
  .link {
    fill: none;
    stroke: #ccc;
    stroke-width: 1.5px;
  }

  .templink {
    fill: none;
    stroke: red;
    stroke-width: 3px;
  }

  .ghostCircle.show{
      display:block;
  }

  .ghostCircle, .activeDrag .ghostCircle{
       display: none;
  }
  
  .edit-branch-member {
	width: 200px;
	height: 400px;
	background: white;
	box-shadow: 0 0 15px;
	position: absolute;
	border-radius:10px;
	display:none;
 }
 
.edit-bm-branch {
	display: flex;
	background: #e1e1e1;
	height: 50px;
	border-bottom: 1px solid;
}

.edit-bm-branch-img {
    flex: 3;
}

.edit-bm-branch-img div,.edit-bm-list-img div {
	width: 85%;
	height: 40px;
	background: gray;
	margin: 5px;
	text-align: center;
	line-height: 40px;
	border-radius: 10px;
	color: white;
	font-size: 15px;
}

.edit-bm-branch-name {
    flex: 10;
}

.edit-bm-branch-name div {
    width: 80%;
    height: 35px;
    background: white;
    border: 1px solid #d2d2d2;
    margin: 7px;
    border-radius: 8px;
    line-height: 35px;
}

.edit-bm-list {
	display: flex;
	border-bottom: 1px solid;
}

.edit-bm-list-chk {
    flex: 4;
}

.edit-bm-list-chk div {
	width: 25px;
	height: 25px;
	border: 1px solid #a1a1a1;
	background: white;
	border-radius: 30px;
	margin: 12px 6px;
}

.edit-bm-list-img {
    flex: 5;
}

.edit-bm-list-content {
    flex: 12;
    padding: 5px;
}
</style>
<script src="jquery.js"></script>
<script src="d3.v3.min.js"></script>
<script src="dndTree_test.js"></script>
<script>
$(function() {
	var member_arr = [
["張桓瑞", "主任", "APP技術部"],
["林慶安", "工程師", "APP技術部"],
["李運彬", "工程師", "APP技術部"],
["李慧茹", "工程師", "APP技術部"],
["謝婕妤", "主任", "APP業務部"],
["鄭雅倫", "經理", "財會部"],
["石國建", "工程師", "MIS群組"],
["朱少英", "主任", "APP專案部"],
["吳年傑", "工程師", "離職員工"],
["蔡閔弘", "工程師", "APP技術部"],
["徐維淩", "主任", "金融產規部"],
["鄭又欽", "工程師", "機房群組"],
["賴郁涵", "工程師", "QC群組"],
["吳振銘", "工程師", "APP技術部"],
["林進鴻", "工程師", "離職員工"],
["賴致仁", "工程師", "APP技術部"],
["李國駿", "工程師", "APP技術部"],
["黃佳榮", "工程師", "QC群組"],
["馮啟豪", "工程師", "APP專案部"],
["蕭婉伶", "工程師", "APP專案部"],
["洪士倫", "工程師", "離職員工"],
["吳小秋", "工程師", "APP專案部"],
["王順興", "工程師", "APP技術部"],
["郭俊佑", "工程師", "APP技術部"],
["郭柏暉", "工程師", "金融研發本部"],
["陳明義", "工程師", "金融研發一部"],
["李侃縣", "主任", "金融研發本部"],
["李明鴻", "客服專員", "客服群組"],
["李昆達", "工程師", "APP技術部"],
["曾威智", "業務專員", "簡訊業務部"],
["楊心瑜", "助理工程師", "金融研發一部"],
["張正芳", "工程師", "APP技術部"],
["牟信安", "經理", "離職員工"],
["?振丞", "工程師", "簡訊研發部"],
["高以任", "工程師", "金融研發二部"],
["吳家彥", "工程師", "金融研發三部"],
["高弘明", "主任", "APP專案部"],
["范姜士威", "工程師", "金融研發一部"],
["何嘉騏", "工程師", "APP技術部"],
["黃子秦", "助理", "系統維運部"],
["尤俊雄", "經理", "簡訊業務部"],
["陳萩憶", "行銷專員", "策略行銷部"],
["廖于瑩", "專員", "財會部"],
["洪婉萍", "專員", "管理部"],
["郭凱迪", "主任", "離職員工"],
["何智群", "工程師", "機房群組"],
["陳怡君", "專員", "財會部"],
["吳炅儒", "工程師", "金融研發二部"],
["巫明侃", "工程師", "金融研發二部"],
["簡訊維運群組", "簡訊維運群組", "簡訊研發部"],
["周曉吟", "助理", "金融業務部"],
["王仕霖", "工程師", "簡訊研發部"],
["楊佩芬", "客服專員", "客服群組"],
["楊澤富", "工程師", "金融產規部"],
["邱柏淳", "工程師", "金融軟體部"],
["卜正偉", "副理", "APP專案部"],
["許振唯", "工程師", "APP技術部"],
["蘇文賢", "工程師", "APP技術部"],
["黃翔邦", "工程師", "APP技術部"],
["莊承祐", "業務專員", "簡訊業務部"],
["曹明哲", "協理", "APP專案部"],
["張秦綺", "業務專員", "離職員工"],
["李清松", "經理", "總經理室"],
["吳育霆", "經理", "簡訊研發部"],
["盧盈君", "工程師", "金融研發三部"],
["繆翔", "工程師", "簡訊研發部"],
["陳?杰", "主任", "簡訊研發部"],
["葉恒嘉", "工程師", "APP技術部"],
["郭仲凱", "工程師", "金融研發一部"],
["余幸潔", "工程師", "離職員工"],
["蔡宇婷", "業務專員", "簡訊業務部"],
["林逸珊", "工程師", "APP技術部"],
["鄭乃瑜", "助理", "簡訊業務部"],
["袁若鈞", "工程師", "雲端平台應用開發部"],
["阮冠儒", "經理", "離職員工"],
["李昀潔", "經理", "雲端產品發展部"],
["李俊霖", "工程師", "金融產規部"],
["謝旭諺", "工程師", "金融研發二部"],
["劉宜鑫", "工程師", "金融研發二部"],
["籃珮菱", "主任", "APP專案部"],
["莊仁銘", "業務專員", "離職員工"],
["俞又文", "客服專員", "客服群組"],
["粘智強", "顧問", "雲端核心技術研發部"],
["沈勃甫", "顧問", "雲端平台應用開發部"],
["陳昭宇", "顧問", "雲端核心技術研發部"],
["郭守立", "顧問", "雲端核心技術研發部"],
["許淑瑞", "業務專員", "APP業務部"],
["洪薪惠", "主任", "APP專案部"],
["涂筱瑋", "技術專員", "雲端系統服務技術部"],
["周幸樺", "工程師", "QC群組"],
["黃詩涵", "助理", "APP業務部"],
["楊宗瑜", "工程師", "雲端平台應用開發部"],
["吳毓臻", "客服專員", "客服群組"],
["郭妍蓁", "客服專員", "離職員工"],
["蔡?萱", "客服專員", "客服群組"],
["陳柏偉", "工程師", "APP技術部"],
["陳群元", "工程師", "APP技術部"],
["劉冠宏", "主任", "離職員工"],
["曾宇田", "工程師", "雲端平台應用開發部"],
["陳佳宏", "工程師", "離職員工"],
["陳詩禮", "工程師", "雲端平台應用開發部"],
["林韋辰", "工程師", "APP技術部"],
["吳念齊", "主任", "離職員工"],
["林均翰", "企劃專員", "雲端產品發展部"],
["趙紫婕", "主任", "APP專案部"],
["吳仁弘", "工程師", "雲端平台應用開發部"],
["陳御華", "技術專員", "雲端平台應用開發部"],
["曾文祈", "企劃專員", "雲端產品發展部"],
["林佳慧", "行銷專員", "策略行銷部"],
["李希強", "主任", "APP技術部"],
["黃郁期", "業務專員", "金融業務部"],
["吳孟芹", "業務專員", "簡訊業務部"],
["陳柏言", "工程師", "雲端平台應用開發部"],
["曾玉文", "主任", "簡訊業務部"],
["葉長泰", "工程師", "APP技術部"],
["牟世傑", "工程師", "APP技術部"],
["周迪", "工程師", "APP技術部"],
["蘇偉德", "工程師", "雲端核心技術研發部"],
["劉宜惠", "企劃專員", "雲端產品發展部"],
["簡聖霖", "經理", "APP產品部"],
["朱恩廷", "工程師", "金融研發二部"],
["林駿逸", "主任", "APP專案部"],
["張慧文", "工程師", "APP專案部"],
["王英哲", "工程師", "MIS群組"],
["謝博伶", "顧問", "雲端核心技術研發部"],
["史諾曼", "顧問", "雲端核心技術研發部"],
["王瓊善", "工程師", "QC群組"],
["陳延昕", "工程師", "金融產規部"],
["呂志倫", "工程師", "金融研發一部"],
["黃議德", "主任", "簡訊業務部"],
["張育能", "專員", "總經理室"],
["朱尚禮", "工程師", "APP技術部"],
["簡玉雯", "助理", "簡訊業務部"],
["王筱蓉", "助理", "APP專案部"],
["黃士瑋", "工程師", "金融研發二部"] 
	                  ];
	
	test_arr = ["陳明義", "楊心瑜", "范姜士威", "郭仲凱", "呂志倫"] ;
	/* console.log(member_arr);
	return false; */
	
	var hierachy_arr = {"name":"三竹資訊","children":[{"name":"金融服務事業群","children":[{"name":"系統維運部","children":[{"name":"MIS群組"},{"name":"機房群組"}]},{"name":"金融產規部","children":[{"name":"客服群組"},{"name":"QC群組"}]},{"name":"金融軟體部"},{"name":"金融研發一部"},{"name":"金融研發三部"},{"name":"金融研發二部"},{"name":"金融研發本部"},{"name":"金融業務部"}]},{"name":"管理部"},{"name":"企業簡訊事業群","children":[{"name":"簡訊研發部"},{"name":"簡訊業務部"}]},{"name":"財會部"},{"name":"策略行銷部"},{"name":"雲端服務事業群","children":[{"name":"雲端核心技術研發部"},{"name":"雲端平台應用開發部"},{"name":"雲端產品發展部"},{"name":"雲端系統服務技術部"}]},{"name":"APP應用事業群","children":[{"name":"APP技術部"},{"name":"APP專案部"},{"name":"APP業務部"},{"name":"APP產品部"}]},{"name":"離職員工"},{"name":"副總經理室"},{"name":"總經理室"}]};
	//var hierachy_arr = {"name":"三竹資訊","children":[{"name":"金融服務事業群","children":[{"name":"系統維運部","children":[{"name":"MIS群組"},{"name":"機房群組"}]}]}]};
	
	var queue = [];
	
	treeMake(hierachy_arr,queue);
	
	

    var scale_out_cnt = 8;
    
    $(document).on("click",function(){
    	$(".edit-branch-member").hide();
    });
    
    $(".edit-branch-member").click(function(e){
    	e.stopPropagation();
    });
    
    $("#undo").click(function(){
    	console.log(queue);
    	if($("#undo-cnt").val() > 0){
    		$("#tree-container").html("");
    		treeMake(queue[$("#undo-cnt").val()-1],queue,$("#undo-cnt").val()-1);
    		$("#undo-cnt").val($("#undo-cnt").val()-1);
    	}else{
    		console.log("最舊");
    	}
    });
    
    $("#redo").click(function(){
        if(queue[$("#undo-cnt").val()*1+1]){
            $("#tree-container").html("");
            treeMake(queue[$("#undo-cnt").val()*1+1],queue,$("#undo-cnt").val()*1+1);
            $("#undo-cnt").val($("#undo-cnt").val()*1+1);
        }else{
            console.log("最新");
        }
    });
    
	$(document).on("click","circle",function(e){
		e.stopPropagation();
		$(".edit-branch-member").css("top",$(this).offset().top-70);
		$(".edit-branch-member").css("left",$(this).offset().left+40);
		$(".edit-branch-member").show();
		scaleIn($(".edit-branch-member"));
		console.log($(this).parent().find("text").html());
		
		var branch_member = [];
		branch_name = $(this).parent().find("text").html();
		$.each(member_arr,function(i,val){
			if(val[2] == branch_name){
				temp_arr = [];
				temp_arr[0] = val[0];
				temp_arr[1] = val[1];
				branch_member.push(temp_arr);
			}
		});

		$(".edit-bm-branch-name div").html(branch_name);
		$(".edit-bm-list-area").html("");
		$.each(branch_member,function(i,val){
			$(".edit-bm-list-area").append(
				'<div class="edit-bm-list">'+
		            '<div class="edit-bm-list-chk"><div></div></div>'+
		            '<div class="edit-bm-list-img"><div>照片</div></div>'+
		            '<div class="edit-bm-list-content"><div>'+val[0]+'</div><div>'+val[1]+'</div></div>'+
		        '</div>'
			);
		});
	});
	
	//timeline more
	function scaleIn(target)
	{
	    target.css("transform","scale("+(scale_out_cnt/100)+")");
	    if(scale_out_cnt < 100){
	    	scale_out_cnt+=4;
	        setTimeout(function(){
	        	scaleIn(target);
	        }, 1);
	    }
	}
	
	
	
});
</script>
</head>
<body>
    <div id="tree-container" style=""></div>
    <div class="edit-branch-member">
        <div class="edit-bm-branch">
            <div class="edit-bm-branch-img"><div>照片</div></div>
            <div class="edit-bm-branch-name"><div></div></div>
        </div>
        <div class="edit-bm-list-area"></div>
    </div>
    <input id="undo-cnt" type="text" value="-1"/>
    <button id="undo">上一步</button>
    <button id="redo">下一步</button>
</body>
</html>