<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="../js/jquery.js"></script>
    <script src="js/linq.js"></script>
    <script src="js/jquery.plugin.js"></script>
    
    <script type="text/javascript">
    $(function(){

        var s32_url = "https://project-o.s3.amazonaws.com/groups/5db48ed8-4f8c-4c68-b147-21f4d0a48e7b/0/7da1ebfa-f308-4933-b856-0a118634604e_o?Expires=1719647964&AWSAccessKeyId=AKIAIXGU3YMKDJDPL7IA&Signature=CM4BqsZF4NKi8zh4992hkQ2hXCc%3D";


        $("button").click(function(){

            var reader = new FileReader();
            reader.onloadend = function() {
                var tempImg = new Image();
                tempImg.src = reader.result;
                tempImg.onload = function() {
                    //縮圖
                    var img_obj = imgResizeByCanvas(this,0,0,1280,1280,0.5);
                    $("img").attr("src",img_obj.url);
                    console.debug("ori size:",$("input")[0].files[0].size);
                    console.debug("resize:",img_obj.blob.size);
                }
            }
            reader.readAsDataURL($("input")[0].files[0]);
        })  ;  	
    	

        imgResizeByCanvas = function(img,x,y,max_w,max_h,quality){
            var MAX_WIDTH = max_w;
            var MAX_HEIGHT = max_h;
            var tempW = img.width;
            var tempH = img.height;
            if (tempW > tempH) {
                if (tempW > MAX_WIDTH) {
                    tempH *= MAX_WIDTH / tempW;
                    tempW = MAX_WIDTH;
                }
            } else {
                if (tempH > MAX_HEIGHT) {
                    tempW *= MAX_HEIGHT / tempH;
                    tempH = MAX_HEIGHT;
                }
            }

            var canvas = document.createElement('canvas');
            canvas.width = tempW;
            canvas.height = tempH;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, x, y, tempW, tempH);
            var dataURL = canvas.toDataURL("image/jpeg",quality);
            var img_obj = {
                w: tempW,
                h: tempH,
                blob: dataURItoBlob(dataURL),
                url: dataURL
            }
            return img_obj;
        }

        dataURItoBlob = function(dataURI) {
            var binary = atob(dataURI.split(',')[1]);
            var array = [];
            for(var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {type: 'image/jpeg'});
        }
    	
    });
    </script>
  </head>
  <body>
        <input type="file"/>
        <button>click</button>
        <br/>
        <img src=""/>
  </body>
</html>
