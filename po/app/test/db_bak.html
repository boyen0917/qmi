<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      .data-show {
        width: 500px;
        height: 500px;
        border: 1px solid black;

      }
    </style>
    <link rel="stylesheet" type="text/css" href="datepicker/datetimepicker.css" />
   
    <script src="../js/jquery.js"></script>
    <script src="../js/idbstore.min.js"></script>

   </head>
<body>
  <div class="data-show">
    
  </div>

  <button class="get">get</button>
  <button class="add">add</button>
  <button class="delete">delete</button>


    <script>
      $(function(){


      $("button.get").click(function(){
      });

      $("button.add").click(function(){
      });

      $("button.delete").click(function(){
      });

        function openDB (name,version) {
            var version=version || 1;
            var request=window.indexedDB.open(name,version);
            request.onerror=function(e){
                $("div").append(e.currentTarget.error.message);
            };
            request.onsuccess=function(e){
                myDB.db=e.target.result;

                $("div").append(myDB.name);
            };
            request.onupgradeneeded=function(e){
                $("div").append('DB version changed to '+version);
                myDB.db=e.target.result;


                if(!myDB.db.objectStoreNames.contains('students')){
                    $("div").append("no data la<br/>");
                    var store=myDB.db.createObjectStore('students',{keyPath: 'id'});
                    store.createIndex('nameIndex','name',{unique:true}); 
                    store.createIndex('ageIndex','age',{unique:false}); 
                }

            };
        }

        function closeDB(db){
            db.close();
        }

        function deleteDB(name){
            indexedDB.deleteDatabase(name);
        }

        function addData(db,storeName){
            var transaction=db.transaction(storeName,'readwrite'); 
            var store=transaction.objectStore(storeName); 

            for(var i=0;i<students.length;i++){
                store.add(students[i]);

            }
        }

        function getDataByKey(db,storeName,value){
            var transaction=db.transaction(storeName,'readwrite'); 
            var store=transaction.objectStore(storeName); 
            var request=store.get(value); 
            request.onsuccess=function(e){ 
                var student=e.target.result; 
                console.debug(student); 
            };
        }

        function updateDataByKey(db,storeName,value){
            var transaction=db.transaction(storeName,'readwrite'); 
            var store=transaction.objectStore(storeName); 
            var request=store.get(value); 
            request.onsuccess=function(e){ 
                var student=e.target.result; 
                student.age=35;
                store.put(student); 
            };
        }


        function deleteDataByKey(db,storeName,value){
            var transaction=db.transaction(storeName,'readwrite'); 
            var store=transaction.objectStore(storeName); 
            store.delete(value); 
        }

        function clearObjectStore(db,storeName){
            var transaction=db.transaction(storeName,'readwrite'); 
            var store=transaction.objectStore(storeName); 
            store.clear();
        }

        function getDataByIndex(db,storeName,index_name,value){
            var transaction=db.transaction(storeName);
            var store=transaction.objectStore(storeName);
            var index = store.index(index_name);
            index.get(value).onsuccess=function(e){
                var student=e.target.result;
                $("div").append(student.id);
            }
        }

        function fetchStoreByCursor(db,storeName){
            var transaction=db.transaction(storeName);
            var store=transaction.objectStore(storeName);
            var request=store.openCursor();
            request.onsuccess=function(e){
                var cursor=e.target.result;
                if(cursor){
                    $("div").append(cursor.key);
                    var currentStudent=cursor.value;
                    $("div").append(" " + currentStudent.name + "<br/>");
                    cursor.continue();
                }
            };
        }

        function getMultipleData(db,storeName,index_name,value){
            var transaction=db.transaction(storeName);
            var store=transaction.objectStore(storeName);
            var index = store.index(index_name);
            var request=index.openCursor(IDBKeyRange.only(value));
            var request=index.openCursor(IDBKeyRange.bound('B','F',false,true));
            request.onsuccess=function(e){
                var cursor=e.target.result;
                if(cursor){
                    var student=cursor.value;
                    console.log(student);
                    cursor.continue();
                }
            }
        }

        function deleteObjectStore(db,storeName){
          if(db.objectStoreNames.contains(storeName)){ 
              db.deleteObjectStore(storeName); 
          }
        }

        // openDB(myDB.name,myDB.version);
        // setTimeout(function(){
        //     addData(myDB.db,'students');
        // },1000);

        var myDB={
            name:'test',
            version:1,
            db:null
        };

        var students=[{ 
            id:1001, 
            name:"Byron", 
            age:24 
        },{ 
            id:1002, 
            name:"Frank", 
            age:30 
        },{ 
            id:1003, 
            name:"Aaron", 
            age:26 
        }];

        // indexedDB.deleteDatabase(myDB.name);
        openDB(myDB.name,myDB.version);
        // deleteDB("test");





      });


    </script>
</body>
</html>