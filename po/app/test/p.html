<!DOCTYPE html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <meta charset=utf-8 />
 
        <script>
            $(function() {
                /* a = b = [0,1,2,3,4];
            	$.each(a,function(i,val){
            		console.log("a:"+i);
            		$.each(b,function(i,val){
            			console.log("    b:"+i);
            		});
            	})
            	return false; */
                /* function test(count){
                    
                    //找出誰的父母是 金融服務事業群的下層
                    $.each(group_str_arr,function(i,val){
                        // xx/xx/xx 的[0]等於父母 group_parent
                        if(val.split('/')[1] == val2.split('/')[1] && val2.split('/')[2]){
                            
                            //判斷沒有建過子children就宣告為陣列 才能push
                            if(!hierachy_arr.children[child_cnt].children[child_cnt1].children){
                                hierachy_arr.children[child_cnt].children[child_cnt1].children = [];
                            }
                            //排除重複的
                            dup_chk = 0;
                            $.each(hierachy_arr.children[child_cnt].children[child_cnt1].children,function(dup_i,dup_val){
                                if(dup_val.name == val2.split('/')[2]){
                                    dup_chk = 1;
                                }
                            });
                            if(dup_chk != 1){
                                hierachy_arr.children[child_cnt].children[child_cnt1].children.push({"name":val2.split('/')[2],"size":4434});    
                            }
                            //console.log(val1.split('/')[1]);  
                        }
                        
                    });
                    child_cnt1++;
                    
                }
                
                return false; */
                
                var split_arr,group_str,max_group_cnt=0,group_str_arr=[],group_arr=[];
                group_str_arr[0] = "金融服務事業群/系統維運部/MIS群組";
                group_str_arr[1] = "金融服務事業群/系統維運部";
                group_str_arr[2] = "金融服務事業群/金融產規部/QC群組";
                group_str_arr[3] = "金融服務事業群/金融軟體部";
                group_str_arr[4] = "金融服務事業群/金融研發一部";
                group_str_arr[5] = "管理部";
                group_str_arr[6] = "APP應用事業群/APP專案部";
                group_str_arr[7] = "APP應用事業群/APP業務部";
                
                var hierachy_arr={"name": "三竹資訊","children": []};
                h_child_arr = hierachy_arr.children;
                total=1;
                
                h_child_arr[0]={"name":"brian"};
                h_child_arr[0].children=[];
                h_child_arr[1]={"name":"brian2"};
                h_child_arr[1].children=[];
                
                test(h_child_arr[0].children);
                test(h_child_arr[1].children);
                function test(h_child_arr){
                	
                	h_child_arr[0]={"name":"mia"};
                    h_child_arr[0].children=[];
                    
                    return false;
                	
                	/* if(total < 3){
                		new_h_child_arr[0]={"name":"mia"};
                		new_h_child_arr[0].children=[];
                        total++;
                        test(new_h_child_arr[0].children=[]);
                	}
                	return new_h_child_arr; */
                	
                }
                
                console.log(h_child_arr);
                return false;
                
                for(count=0;count<total;count++){
                	
                	window['child_cnt'+count] = 0;
                	
                	$.each(group_str_arr,function(i,val){
                		//設定父階層 若等於零 則預設是第一個值 [0]
                		if(count==0){
                            group_parent = val.split('/')[0];
                        }else{
                            group_parent = window['group_parent'+(count-1)];
                        }
                		//排除重複的name
                        dup_chk = 0;
                        $.each(h_child_arr,function(dup_i,dup_val){
                            if(dup_val.name == group_parent){
                                dup_chk = 1;
                            }
                        });
                        
                        //父階層存在而且不重複
                        if(group_parent && dup_chk != 1){
                        	//將父階層group_parent 存進 h_child_arr
                            h_child_arr[window['child_cnt'+count]] = {"name":group_parent};
                        	
                        	//重新掃描 將屬於父階層group_parent 的子階層 group_child 存進 父階層的鄰兵陣列 .children中
                        	$.each(group_str_arr,function(i,val){
                        		
                                // 存這階段的父階層和子階層
                                window['group_parent'+count] = val.split('/')[count];
                                window['group_children'+count] = val.split('/')[count+1];
                                
                                //這階段的父階層等於 目標的父階層 而且子階層有存在
                                if(group_parent == window['group_parent'+count] && window['group_children'+count]){
                                    
                                    //將子階層存進父階層的鄰兵陣列 children 裏
                                    //先判斷父階層的鄰兵陣列 children 存在
                                    if(!h_child_arr[window['child_cnt'+count]].children){
                                    	h_child_arr[window['child_cnt'+count]].children = [];
                                    }
                                    
                                  //排除重複的子階層
                                    dup_chk = 0;
                                    $.each(h_child_arr[window['child_cnt'+count]].children,function(dup_i,dup_val){
                                        if(dup_val.name == window['group_children'+count]){
                                            dup_chk = 1;
                                        }
                                    });
                                    if(dup_chk != 1){
                                    	h_child_arr[window['child_cnt'+count]].children.push({"name":window['group_children'+count]});
                                    	
                                    	hierachyMake(h_child_arr[window['child_cnt'+count]].children,window['group_children'+count]);
                                    }
                                }
                                
                            });
                            window['child_cnt'+count]++;
                        }
                	});
                } 
                
                //window['child_cnt'+count] 似乎不需要惹 可重複使用
                //count 應該不用for 而是自用函數自己判斷
                
                function hierachyMake(h_child_arr,group_parent){
                	//重新掃描 將屬於父階層group_parent 的子階層 group_child 存進 父階層的鄰兵陣列 .children中
                    $.each(group_str_arr,function(i,val){
                        
                        // 存這階段的父階層和子階層
                        this_parent = val.split('/')[count];
                        this_child = val.split('/')[count+1];
                        
                        //這階段的父階層等於 目標的父階層 而且子階層有存在
                        if(group_parent == this_parent && this_child){
                 
                        	
                        	//開始～～
                        	
                        	
                        	
                        	
                        	
                            //將子階層存進父階層的鄰兵陣列 children 裏
                            //先判斷父階層的鄰兵陣列 children 存在
                            if(!h_child_arr[child_cnt].children){
                                h_child_arr[window['child_cnt'+count]].children = [];
                            }
                            
                          //排除重複的子階層
                            dup_chk = 0;
                            $.each(h_child_arr[window['child_cnt'+count]].children,function(dup_i,dup_val){
                                if(dup_val.name == window['group_children'+count]){
                                    dup_chk = 1;
                                }
                            });
                            if(dup_chk != 1){
                                h_child_arr[window['child_cnt'+count]].children.push({"name":window['group_children'+count]});
                            }
                         }
                        
                    });
                    window['child_cnt'+count]++;
                }
                
                hierachy_arr.children = h_child_arr;
                
                console.log(h_child_arr);
                console.log(hierachy_arr);
                return false;
                
                
                
                /* console.log(hierachy_arr);return false; */
                $.ajax({
                      url: "20140411.txt",
                      success: function(data){
                         
                        split_arr = data.split('\n');
                        //先做第一次的篩選
                        $.each(split_arr,function(i,val){
                            if(val.split(',')[3]){
                                if($.inArray(val.split(',')[3], group_str_arr) < 0){
                                    group_str_arr.push(val.split(',')[3]);
                                }
                                
                                if(val){
                                    group_str = val.split(',')[3];
                                    if(max_group_cnt < group_str.split('/').length){
                                        max_group_cnt = group_str.split('/').length;
                                    }
                                }
                                
                                $.each(val.split(',')[3].split('/'),function(s_i,s_val){
                                    if($.inArray(s_val, group_arr) < 0 && s_val){
                                        group_arr.push(s_val);
                                    }
                                });
                            }
                        });
                        
                        count = 0;
                        $.each(group_str_arr,function(i,val){
                            //val.split('/')[0] = "金融服務事業群"
                            group_parent = val.split('/')[0];
                            
                            //排除重複的
                            dup_chk = 0;
                            $.each(hierachy_arr.children,function(dup_i,dup_val){
                                if(dup_val.name == group_parent){
                                    dup_chk = 1;
                                }
                            });
                            if(group_parent && dup_chk != 1){
                                //val = 金融服務事業群/系統維運部/MIS群組
                                hierachy_arr.children[i] = {"name":group_parent};
                                
                                //找出誰的父母是 金融服務事業群
                                $.each(group_str_arr,function(i,val){
                                    // xx/xx/xx 的[0]等於父母 group_parent
                                    window['group_parent'+count] = val.split('/')[count];
                                    window['group_children'+count] = val1.split('/')[count+1];
                                    if(group_parent == window['group_parent'+count] && window['group_children'+count]){
                                        //判斷沒有建過子children就宣告為陣列 才能push
                                        if(!hierachy_arr.children[i].children){
                                            hierachy_arr.children[i].children = [];
                                        }
                                        //排除重複的
                                        dup_chk = 0;
                                        $.each(hierachy_arr.children[i].children,function(dup_i,dup_val){
                                            if(dup_val.name == val.split('/')[1]){
                                                dup_chk = 1;
                                            }
                                        });
                                        if(dup_chk != 1){
                                            hierachy_arr.children[i].children.push({"name":val1.split('/')[1]});    
                                            
/* ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- */                                     
                                            //找出誰的父母是 金融服務事業群的下層
                                            $.each(group_str_arr,function(i2,val2){
                                                // xx/xx/xx 的[0]等於父母 group_parent
                                                if(val1.split('/')[1] == val2.split('/')[1] && val2.split('/')[2]){
                                                    
                                                    //判斷沒有建過子children就宣告為陣列 才能push
                                                    if(!hierachy_arr.children[child_cnt].children[child_cnt1].children){
                                                        hierachy_arr.children[child_cnt].children[child_cnt1].children = [];
                                                    }
                                                    //排除重複的
                                                    dup_chk = 0;
                                                    $.each(hierachy_arr.children[child_cnt].children[child_cnt1].children,function(dup_i,dup_val){
                                                        if(dup_val.name == val2.split('/')[2]){
                                                            dup_chk = 1;
                                                        }
                                                    });
                                                    if(dup_chk != 1){
                                                        hierachy_arr.children[child_cnt].children[child_cnt1].children.push({"name":val2.split('/')[2],"size":4434});    
                                                    }
                                                    //console.log(val1.split('/')[1]);  
                                                }
                                                
                                            });
                                            child_cnt1++;
    /* ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- */
                                            
                                        }

                                    }
                                    
                                });
                             }
                        });
                        console.log(JSON.stringify(hierachy_arr));
                        console.log(group_arr);
                        console.log(group_str_arr);
                        
                      }
                    });
            });
    
        </script>
 
    </head>
    <body>
 
    </body>
</html>