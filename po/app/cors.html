<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="http://webdev.cloud.mitake.com.tw/po/js/jquery.js"></script>
        <script src="http://webdev.cloud.mitake.com.tw/po/app/js/sha/sha1.js"></script>
        <script src="http://webdev.cloud.mitake.com.tw/po/app/js/sha/enc-base64-min.js"></script>
    </head>
    <body>
        <input id="phone" value="+886980922917"/><br/>
        <input id="code" value="123456"/><br/>
        <button>登入</button>
<br/>
<textarea rows="10" cols="50"></textarea>
        
        <script type="text/javascript">
            $(function(){
                //api 網址
                var base_url = "https://apserver.mitake.com.tw/apiv1/";
                //var base_url = "http://10.1.17.116:8090/apiv1/";
                //ajax用
                var myRand = Math.floor((Math.random()*1000)+1);
                
//--------------登入------------------------------------------------------------------------
                $("button").click(function(){
                    
                    var api_name = "login";
                    var headers = {
                        "id":$("#phone").val(),
                        "up":toSha1Encode($("#code").val()), 
                        "ns":"",
                        "li":"zh_TW"
                    };
                    var method = "post";
                    console.log(headers);
                    var result = ajaxDo(api_name,headers,method,true);
                    result.complete(function(data){
                        $("textarea").html(data);
                    });
                });

//--------------註冊------------------------------------------------------------------------
                //取得otp驗證碼
                var api_name = "register/otp";
                var headers = {
                    "cc":"+886",
                    "pn":"980922917", 
                    "di":"qwer",
                    "li":"zh_TW"
                };
                var method = "get";
                
                console.log(headers);
                
                var result = ajaxDo(api_name,headers,method,true);
                result.complete(function(data){
                	console.log(data);
                });
 
//--------------驗證------------------------------------------------------------------------
                /* var api_name = "register/otp";
                var headers = {
                    "cc":"+886",
                    "pn":"980922917", 
                    "di":"qwer",
                    "op":toSha1Encode("2047")
                };
                var method = "post";

                console.log(headers);
                var result = ajaxDo(api_name,headers,method,true);
                result.complete(function(data){
                	console.log(data);
                }); */
                
                function ajaxDo(api_name,headers,method,async){
                    //console.log(api_url);
                    var api_url = base_url + api_name;
                    var myRand = Math.floor((Math.random()*1000)+1);
                    
                    if(async){
                        var result = $.ajax ({
                            url: api_url,
                            type: method,
                            headers:headers,
                        });/* ajax結束 */
                    }                    
                    return result;
                }
                
                //sha1 and base64 encode
                function toSha1Encode(string){
                    var hash = CryptoJS.SHA1(string);
                    var toBase64 = hash.toString(CryptoJS.enc.Base64);
                    return toBase64;
                }
                
            });
        </script>
    </body>
</html>