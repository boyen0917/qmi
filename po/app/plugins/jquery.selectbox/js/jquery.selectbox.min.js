/* glorialin edited for Qmi */

/*
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
 !function(e,s){function t(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var i="selectbox",a=!1,l=!0;e.extend(t.prototype,{_isOpenSelectbox:function(e){if(!e)return a;var s=this._getInst(e);return s.isOpen},_isDisabledSelectbox:function(e){if(!e)return a;var s=this._getInst(e);return s.isDisabled},_attachSelectbox:function(s,t){function n(){var s,t,i=this.attr("id").split("_")[1];for(s in p._state)s!==i&&p._state.hasOwnProperty(s)&&(t=e("select[sb='"+s+"']")[0],t&&p._closeSelectbox(t))}function o(){var t=arguments[1]&&arguments[1].sub?!0:!1,i=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(a){var n,o=e(this),c=e("<li>");o.is(":selected")&&(d.text(o.text()),h=l),a===_-1&&c.addClass("last"),o.is(":disabled")||i?(n=e("<span>",{text:o.text()}).addClass(g.settings.classDisabled),t&&n.addClass(g.settings.classSub),n.appendTo(c)):(n=e("<label>",{href:"#"+o.val(),rel:o.val()}).text(o.text()).bind("click.sb",function(t){t&&t.preventDefault&&t.preventDefault();{var i=r,a=e(this);i.attr("id").split("_")[1]}p._changeSelectbox(s,a.attr("rel"),a.text()),p._closeSelectbox(s)}).bind("mouseover.sb",function(){var s=e(this);s.parent().siblings().find("label").removeClass(g.settings.classFocus),s.addClass(g.settings.classFocus)}).bind("mouseout.sb",function(){e(this).removeClass(g.settings.classFocus)}),t&&n.addClass(g.settings.classSub),o.is(":selected")&&n.addClass(g.settings.classFocus),n.appendTo(c)),c.appendTo(u)})}if(this._getInst(s))return a;var c,d,r,u,b=e(s),p=this,g=p._newInst(b),h=a,f=(b.find("optgroup"),b.find("option")),_=f.length;b.attr("sb",g.uid),e.extend(g.settings,p._defaults,t),p._state[g.uid]=a,b.hide(),c=e("<div>",{id:"sbHolder_"+g.uid,"class":g.settings.classHolder,tabindex:b.attr("tabindex")}),d=e("<label>",{id:"sbSelector_"+g.uid,href:"#","class":g.settings.classSelector,click:function(t){t.preventDefault(),n.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];p._state[i]?p._closeSelectbox(s):p._openSelectbox(s)}}),r=e("<label>",{id:"sbToggle_"+g.uid,href:"#","class":g.settings.classToggle,click:function(t){t.preventDefault(),n.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];p._state[i]?p._closeSelectbox(s):p._openSelectbox(s)}}),r.appendTo(c),u=e("<ul>",{id:"sbOptions_"+g.uid,"class":g.settings.classOptions,css:{display:"none"}}),b.children().each(function(){var s,t=e(this),i={};t.is("option")?o(t):t.is("optgroup")&&(s=e("<li>"),e("<span>",{text:t.attr("label")}).addClass(g.settings.classGroup).appendTo(s),s.appendTo(u),t.is(":disabled")&&(i.disabled=!0),i.sub=!0,o(t.find("option"),i))}),h||d.text(f.first().text()),e.data(s,i,g),c.data("uid",g.uid).bind("keydown.sb",function(s){var t=s.charCode?s.charCode:s.keyCode?s.keyCode:0,a=e(this),l=a.data("uid"),n=a.siblings("select[sb='"+l+"']").data(i),o=a.siblings(["select[sb='",l,"']"].join("")).get(0),c=a.find("ul").find("label."+n.settings.classFocus);switch(t){case 37:case 38:if(c.length>0){var d;e("label",a).removeClass(n.settings.classFocus),d=c.parent().prevAll("li:has(label)").eq(0).find("label"),d.length>0&&(d.addClass(n.settings.classFocus).focus(),e("#sbSelector_"+l).text(d.text()))}break;case 39:case 40:var d;e("label",a).removeClass(n.settings.classFocus),d=c.length>0?c.parent().nextAll("li:has(label)").eq(0).find("label"):a.find("ul").find("label").eq(0),d.length>0&&(d.addClass(n.settings.classFocus).focus(),e("#sbSelector_"+l).text(d.text()));break;case 13:c.length>0&&p._changeSelectbox(o,c.attr("rel"),c.text()),p._closeSelectbox(o);break;case 9:if(o){var n=p._getInst(o);n&&(c.length>0&&p._changeSelectbox(o,c.attr("rel"),c.text()),p._closeSelectbox(o))}var r=parseInt(a.attr("tabindex"),10);s.shiftKey?r--:r++,e("*[tabindex='"+r+"']").focus();break;case 27:p._closeSelectbox(o)}return s.stopPropagation(),!1}).delegate("label","mouseover",function(){e(this).addClass(g.settings.classFocus)}).delegate("label","mouseout",function(){e(this).removeClass(g.settings.classFocus)}),d.appendTo(c),u.appendTo(c),c.insertAfter(b),cns.debug(d.height()),d.css("line-height",d.height()+"px"),e("html").on("mousedown",function(s){s.stopPropagation(),e("select").selectbox("close")}),e([".",g.settings.classHolder,", .",g.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(s){var t=this._getInst(s);return t?(e("#sbHolder_"+t.uid).remove(),e.data(s,i,null),void e(s).show()):a},_changeSelectbox:function(s,t,i){var a,n=this._getInst(s);n&&(a=this._get(n,"onChange"),e("#sbSelector_"+n.uid).text(i)),t=t.replace(/\'/g,"\\'"),e(s).find("option[value='"+t+"']").attr("selected",l),n&&a?a.apply(n.input?n.input[0]:null,[t,n]):n&&n.input&&n.input.trigger("change")},_enableSelectbox:function(s){var t=this._getInst(s);return t&&t.isDisabled?(e("#sbHolder_"+t.uid).removeClass(t.settings.classHolderDisabled),t.isDisabled=a,void e.data(s,i,t)):a},_disableSelectbox:function(s){var t=this._getInst(s);return!t||t.isDisabled?a:(e("#sbHolder_"+t.uid).addClass(t.settings.classHolderDisabled),t.isDisabled=l,void e.data(s,i,t))},_optionSelectbox:function(s,t,l){var n=this._getInst(s);return n?(n[t]=l,void e.data(s,i,n)):a},_openSelectbox:function(s){var t=this._getInst(s);if(t&&!t.isOpen&&!t.isDisabled){var a=e("#sbOptions_"+t.uid),n=parseInt(e(window).height(),10),o=e("#sbHolder_"+t.uid).offset(),c=e(window).scrollTop(),d=a.prev().height(),r=n-(o.top-c)-d/2,u=this._get(t,"onOpen");a.css({top:d+"px",maxHeight:r-d+"px"}),"fade"===t.settings.effect?a.fadeIn(t.settings.speed):a.slideDown(t.settings.speed),e("#sbToggle_"+t.uid).addClass(t.settings.classToggleOpen),this._state[t.uid]=l,t.isOpen=l,u&&u.apply(t.input?t.input[0]:null,[t]),e.data(s,i,t)}},_closeSelectbox:function(s){var t=this._getInst(s);if(t&&t.isOpen){var l=this._get(t,"onClose");"fade"===t.settings.effect?e("#sbOptions_"+t.uid).fadeOut(t.settings.speed):e("#sbOptions_"+t.uid).slideUp(t.settings.speed),e("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),this._state[t.uid]=a,t.isOpen=a,l&&l.apply(t.input?t.input[0]:null,[t]),e.data(s,i,t)}},_newInst:function(e){var s=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:s,input:e,uid:Math.floor(99999999*Math.random()),isOpen:a,isDisabled:a,settings:{}}},_getInst:function(s){try{return e.data(s,i)}catch(t){throw"Missing instance data for this selectbox"}},_get:function(e,t){return e.settings[t]!==s?e.settings[t]:this._defaults[t]}}),e.fn.selectbox=function(s){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):this.each(function(){"string"==typeof s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this].concat(t)):e.selectbox._attachSelectbox(this,s)})},e.selectbox=new t,e.selectbox.version="0.2"}(jQuery);
 